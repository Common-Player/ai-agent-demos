# ğŸ”§ å†å²è®°å½•ä¸ºç©ºé—®é¢˜è¯Šæ–­æŒ‡å—

## ğŸ¯ é—®é¢˜æè¿°
å³ä½¿ç”¨æˆ·æœ‰ç”Ÿæˆè®°å½•ï¼Œå†å²è®°å½•ä¹Ÿæ˜¾ç¤ºä¸ºç©ºã€‚

## ğŸ” è¯Šæ–­æ­¥éª¤

### 1ï¸âƒ£ è¿è¡Œè°ƒè¯•è„šæœ¬
```bash
python3 debug_test.py
```

è¿™ä¸ªè„šæœ¬ä¼šæ£€æŸ¥ï¼š
- âœ… Supabaseè¿æ¥æ˜¯å¦æ­£å¸¸
- âœ… æ•°æ®åº“è¡¨æ˜¯å¦å­˜åœ¨
- âœ… è®¤è¯å’Œå†å²è®°å½•ç®¡ç†å™¨æ˜¯å¦æ­£å¸¸

### 2ï¸âƒ£ æ£€æŸ¥æ•°æ®åº“è¡¨
**æœ€å¯èƒ½çš„é—®é¢˜**: æ•°æ®åº“è¡¨æœªåˆ›å»º

è¯·åœ¨Supabase Dashboardä¸­æ‰§è¡Œä»¥ä¸‹SQLï¼š

```sql
-- æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_name IN ('prompt_history', 'webpage_generations');

-- å¦‚æœè¡¨ä¸å­˜åœ¨ï¼Œæ‰§è¡Œåˆ›å»ºè¯­å¥
CREATE TABLE IF NOT EXISTS prompt_history (
    id BIGSERIAL PRIMARY KEY,
    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
    prompt TEXT NOT NULL,
    response TEXT NOT NULL,
    prompt_type VARCHAR(50) DEFAULT 'custom',
    model_type VARCHAR(50) DEFAULT 'simple',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS webpage_generations (
    id BIGSERIAL PRIMARY KEY,
    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
    prompt TEXT NOT NULL,
    html_content TEXT,
    filename VARCHAR(255),
    design_type VARCHAR(50) DEFAULT 'ai_design',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- å¯ç”¨è¡Œçº§å®‰å…¨ç­–ç•¥
ALTER TABLE prompt_history ENABLE ROW LEVEL SECURITY;
ALTER TABLE webpage_generations ENABLE ROW LEVEL SECURITY;

-- åˆ›å»ºå®‰å…¨ç­–ç•¥
CREATE POLICY "Users can only access their own prompt history" ON prompt_history
    FOR ALL USING (auth.uid() = user_id);

CREATE POLICY "Users can only access their own webpage generations" ON webpage_generations
    FOR ALL USING (auth.uid() = user_id);

CREATE POLICY "Authenticated users can insert prompt history" ON prompt_history
    FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Authenticated users can insert webpage generations" ON webpage_generations
    FOR INSERT WITH CHECK (auth.uid() = user_id);
```

### 3ï¸âƒ£ å¯åŠ¨åº”ç”¨å¹¶æŸ¥çœ‹æ—¥å¿—
```bash
python run_web.py
```

ç°åœ¨åº”ç”¨ä¼šè¾“å‡ºè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼š
- ğŸ’¾ ä¿å­˜å†å²è®°å½•çš„ç»“æœ
- ğŸ“Š è·å–å†å²è®°å½•çš„æ•°é‡
- ğŸŒ ç½‘é¡µç”Ÿæˆè®°å½•çš„ä¿å­˜çŠ¶æ€

### 4ï¸âƒ£ åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•
1. æ‰“å¼€ http://localhost:8080
2. ç™»å½•æ‚¨çš„è´¦å·
3. å°è¯•ç”Ÿæˆä¸€ä¸ªç½‘é¡µ
4. æŸ¥çœ‹å³ä¾§å†å²è®°å½•é¢æ¿
5. æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ŒæŸ¥çœ‹Consoleæ ‡ç­¾

æ‚¨åº”è¯¥èƒ½çœ‹åˆ°ï¼š
```
å†å²è®°å½•APIè°ƒç”¨ç»“æœ (prompts): {success: true, history: [...], total: X}
å†å²è®°å½•æ•°æ® (prompts): [...]
```

## ğŸ› å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: æ•°æ®åº“è¿æ¥å¤±è´¥
**é”™è¯¯**: `âŒ Supabaseè¿æ¥å¤±è´¥`
**è§£å†³**: æ£€æŸ¥.envæ–‡ä»¶ä¸­çš„SUPABASE_URLå’ŒSUPABASE_ANON_KEYæ˜¯å¦æ­£ç¡®

### é—®é¢˜2: è¡¨ä¸å­˜åœ¨
**é”™è¯¯**: `âŒ prompt_historyè¡¨æŸ¥è¯¢å¤±è´¥`
**è§£å†³**: åœ¨Supabase Dashboardä¸­æ‰§è¡Œä¸Šé¢çš„å»ºè¡¨SQL

### é—®é¢˜3: æƒé™é—®é¢˜
**é”™è¯¯**: `æ’å…¥æ•°æ®å¤±è´¥`
**è§£å†³**: ç¡®ä¿RLSç­–ç•¥æ­£ç¡®åˆ›å»ºï¼Œç”¨æˆ·æœ‰è®¿é—®æƒé™

### é—®é¢˜4: ç”¨æˆ·IDä¸åŒ¹é…
**é”™è¯¯**: `ä¿å­˜æˆåŠŸä½†æŸ¥è¯¢ä¸ºç©º`
**è§£å†³**: æ£€æŸ¥ç”¨æˆ·è®¤è¯çŠ¶æ€ï¼Œç¡®ä¿user_idæ­£ç¡®ä¼ é€’

## ğŸ”§ æ‰‹åŠ¨éªŒè¯æ•°æ®

### åœ¨Supabase Dashboardä¸­æŸ¥è¯¢ï¼š
```sql
-- æŸ¥çœ‹æ‰€æœ‰æç¤ºè¯è®°å½•
SELECT * FROM prompt_history ORDER BY created_at DESC LIMIT 10;

-- æŸ¥çœ‹æ‰€æœ‰ç½‘é¡µç”Ÿæˆè®°å½•  
SELECT * FROM webpage_generations ORDER BY created_at DESC LIMIT 10;

-- æŸ¥çœ‹ç‰¹å®šç”¨æˆ·çš„è®°å½•
SELECT * FROM prompt_history WHERE user_id = 'your-user-id';
```

## ğŸ“ ä¸‹ä¸€æ­¥æ“ä½œ

1. **è¿è¡Œè°ƒè¯•è„šæœ¬**: `python3 debug_test.py`
2. **åˆ›å»ºæ•°æ®åº“è¡¨**: æ‰§è¡Œä¸Šé¢çš„SQLè¯­å¥
3. **é‡å¯åº”ç”¨**: `python run_web.py`
4. **æµ‹è¯•åŠŸèƒ½**: ç™»å½•å¹¶ç”Ÿæˆç½‘é¡µ
5. **æŸ¥çœ‹æ—¥å¿—**: æ£€æŸ¥æ§åˆ¶å°è¾“å‡º

å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- æœåŠ¡å™¨æ§åˆ¶å°çš„è°ƒè¯•è¾“å‡º
- æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„Consoleä¿¡æ¯
- Supabase Dashboardä¸­çš„å®é™…æ•°æ® 