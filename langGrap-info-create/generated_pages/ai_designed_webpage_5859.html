<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>飞天大冒险 - 星际指令中心</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400..900&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-glow-color: #00f6ff;
            --secondary-glow-color: #ff00e5;
            --bg-color: #02041b;
            --card-bg-color: rgba(20, 25, 60, 0.5);
            --card-border-color: rgba(0, 246, 255, 0.2);
            --text-color: #e0e5ff;
            --text-muted-color: #9a9fbf;
            --font-primary: 'Orbitron', sans-serif;
            --font-secondary: 'Roboto Mono', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-secondary);
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        /* --- 动态星空背景 --- */
        .stars-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: var(--bg-color) url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><circle cx="10" cy="10" r="1" fill="rgba(255,255,255,0.3)"/><circle cx="50" cy="70" r="0.5" fill="rgba(255,255,255,0.3)"/><circle cx="80" cy="30" r="1.2" fill="rgba(255,255,255,0.3)"/></svg>');
            animation: move-stars 120s linear infinite;
        }

        @keyframes move-stars {
            from { background-position: 0 0; }
            to { background-position: 0 1000px; }
        }

        /* --- 主容器与头部 --- */
        .cockpit-container {
            max-width: 1600px;
            margin: 0 auto;
            perspective: 2000px;
        }

        .cockpit-header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 1s ease-out;
        }

        .cockpit-header h1 {
            font-family: var(--font-primary);
            font-size: 3rem;
            font-weight: 700;
            letter-spacing: 4px;
            text-transform: uppercase;
            color: #fff;
            text-shadow: 0 0 10px var(--primary-glow-color), 0 0 20px var(--primary-glow-color), 0 0 40px var(--primary-glow-color);
        }

        .cockpit-header p {
            font-size: 1.2rem;
            opacity: 0.8;
            margin-top: 10px;
            color: var(--text-muted-color);
            text-shadow: 0 0 5px var(--secondary-glow-color);
        }

        /* --- 驾驶舱网格布局 --- */
        .cockpit-grid {
            display: grid;
            gap: 20px;
            grid-template-columns: repeat(12, 1fr);
            grid-auto-rows: minmax(150px, auto);
            grid-template-areas:
                "time time time weather weather weather news news news news news news"
                "file file file file file file browser browser browser browser browser browser"
                "file file file file file file research research research calc calc calc";
        }

        /* --- 功能模块卡片 (玻璃拟态) --- */
        .module-card {
            background: var(--card-bg-color);
            border: 1px solid var(--card-border-color);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            box-shadow: 0 0 20px rgba(0, 246, 255, 0.1), inset 0 0 15px rgba(255, 255, 255, 0.05);
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            display: flex;
            flex-direction: column;
            animation: module-bootup 0.8s ease-out forwards;
            opacity: 0;
            transform: translateY(40px);
        }

        .module-card:hover {
            transform: translateY(-10px) scale(1.02) rotateX(5deg) rotateY(2deg);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3), 0 0 30px var(--primary-glow-color), inset 0 0 20px rgba(255, 255, 255, 0.1);
            border-color: rgba(0, 246, 255, 0.5);
        }

        /* 卡片布局区域 */
        #time-module { grid-area: time; }
        #weather-module { grid-area: weather; }
        #news-module { grid-area: news; }
        #browser-module { grid-area: browser; }
        #research-module { grid-area: research; }
        #calc-module { grid-area: calc; }
        #file-module { grid-area: file; }

        /* --- 卡片内部样式 --- */
        .module-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--card-border-color);
        }

        .module-icon {
            width: 40px;
            height: 40px;
            margin-right: 15px;
            color: var(--primary-glow-color);
            filter: drop-shadow(0 0 5px var(--primary-glow-color));
        }

        .module-title {
            font-family: var(--font-primary);
            font-size: 1.4rem;
            font-weight: 600;
            color: #fff;
        }

        .module-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        /* --- 输入与按钮 --- */
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .module-input {
            flex: 1;
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--card-border-color);
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-color);
            outline: none;
            transition: all 0.3s ease;
            font-family: var(--font-secondary);
        }

        .module-input:focus {
            border-color: var(--primary-glow-color);
            box-shadow: 0 0 10px var(--primary-glow-color);
        }

        .action-btn {
            padding: 10px 20px;
            background: linear-gradient(45deg, var(--primary-glow-color), var(--secondary-glow-color));
            color: #02041b;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 700;
            font-family: var(--font-primary);
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 246, 255, 0.4);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .auto-btn {
            width: 100%;
            padding: 12px;
            background: transparent;
            border: 2px solid var(--primary-glow-color);
            color: var(--primary-glow-color);
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            font-family: var(--font-primary);
            transition: all 0.3s ease;
            text-transform: uppercase;
        }
        .auto-btn:hover {
            background: var(--primary-glow-color);
            color: var(--bg-color);
            box-shadow: 0 0 15px var(--primary-glow-color);
        }

        /* --- 结果显示区域 --- */
        .result-area {
            flex-grow: 1;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
            overflow-y: auto;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .default-text {
            color: var(--text-muted-color);
            font-style: italic;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        /* --- 加载动画 (未来感) --- */
        .loading-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--primary-glow-color);
            font-family: var(--font-primary);
        }
        .scanner {
            width: 80px;
            height: 20px;
            background: linear-gradient(var(--primary-glow-color), var(--primary-glow-color)) no-repeat;
            background-size: 50% 4px;
            background-position: 0 0;
            animation: scan 2s infinite;
            margin-bottom: 10px;
        }
        @keyframes scan {
            50% { background-position: 100% 0; }
        }

        /* --- 结构化数据美化 --- */
        .result-container { padding: 5px; }
        .result-header {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--card-border-color);
        }
        .result-header h3 {
            font-family: var(--font-primary);
            color: #fff;
            font-size: 1.2rem;
            text-shadow: 0 0 5px var(--primary-glow-color);
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px dashed rgba(0, 246, 255, 0.1);
        }
        .info-row:last-child { border-bottom: none; }
        .label { font-weight: 700; color: var(--text-muted-color); }
        .value { color: var(--text-color); text-align: right; }
        .sub-section h4 {
            font-family: var(--font-primary);
            color: var(--primary-glow-color);
            margin: 15px 0 8px 0;
            font-size: 1rem;
            border-bottom: 1px solid rgba(0, 246, 255, 0.2);
            padding-bottom: 5px;
        }
        .sub-section ul, .sub-section ol { padding-left: 20px; }
        .sub-section li { margin: 5px 0; line-height: 1.5; }
        .article {
            background: rgba(0, 0, 0, 0.2);
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 3px solid var(--primary-glow-color);
        }
        .article h4 { color: #fff; }
        .article-meta { font-size: 0.8rem; color: var(--text-muted-color); margin-bottom: 5px; }
        .content-text {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--card-border-color);
            border-radius: 6px;
            padding: 12px;
            margin-top: 8px;
            white-space: pre-wrap;
            word-break: break-all;
        }

        /* --- 特殊模块样式 --- */
        #time-module .live-clock {
            font-family: var(--font-primary);
            font-size: 3.5rem;
            font-weight: 700;
            text-align: center;
            color: #fff;
            text-shadow: 0 0 10px var(--primary-glow-color), 0 0 20px var(--primary-glow-color);
            margin: auto 0;
        }
        #weather-module .temperature {
            font-size: 2.5rem;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 8px #f59e0b;
        }
        #calc-module .result-value {
            font-size: 2rem;
            font-weight: bold;
            color: #10b981;
            text-shadow: 0 0 8px #10b981;
        }

        /* --- 滚动条样式 --- */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.2); }
        ::-webkit-scrollbar-thumb { background: var(--primary-glow-color); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #fff; }

        /* --- 动画效果 --- */
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes module-bootup {
            from { opacity: 0; transform: translateY(40px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .module-card:nth-child(1) { animation-delay: 0.2s; }
        .module-card:nth-child(2) { animation-delay: 0.3s; }
        .module-card:nth-child(3) { animation-delay: 0.4s; }
        .module-card:nth-child(4) { animation-delay: 0.5s; }
        .module-card:nth-child(5) { animation-delay: 0.6s; }
        .module-card:nth-child(6) { animation-delay: 0.7s; }
        .module-card:nth-child(7) { animation-delay: 0.8s; }

        /* --- 响应式设计 --- */
        @media (max-width: 1200px) {
            .cockpit-grid {
                grid-template-columns: repeat(6, 1fr);
                grid-template-areas:
                    "time time time weather weather weather"
                    "news news news news news news"
                    "browser browser browser browser browser browser"
                    "file file file file file file"
                    "research research research calc calc calc";
            }
        }

        @media (max-width: 768px) {
            body { padding: 15px; }
            .cockpit-header h1 { font-size: 2rem; }
            .cockpit-grid {
                grid-template-columns: 1fr;
                grid-template-areas:
                    "time"
                    "weather"
                    "news"
                    "browser"
                    "research"
                    "calc"
                    "file";
            }
            .input-group { flex-direction: column; }
            #time-module .live-clock { font-size: 3rem; }
        }
    </style>
</head>
<body>
    <div class="stars-bg"></div>
    <div class="cockpit-container">
        <header class="cockpit-header">
            <h1 id="main-title"></h1>
            <p>星际指令中心 // SYSTEM ONLINE</p>
        </header>

        <main class="cockpit-grid">
            <!-- 时间模块 -->
            <section class="module-card" id="time-module">
                <div class="module-header">
                    <svg class="module-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    <h3 class="module-title">星舰时间</h3>
                </div>
                <div class="module-content">
                    <div id="live-clock" class="live-clock">--:--:--</div>
                    <div id="time-result" class="result-area" style="display:none;"></div>
                </div>
            </section>

            <!-- 天气模块 -->
            <section class="module-card" id="weather-module">
                <div class="module-header">
                    <svg class="module-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 10C18 6.68629 15.3137 4 12 4C8.68629 4 6 6.68629 6 10C6 11.8557 6.77173 13.5151 8 14.6672V14.6672C8.39383 14.9431 8.72333 15.1582 9.07533 15.3063C10.222 15.7852 11.0713 16.5859 11.5858 17.5858C11.8418 18.0858 12.1582 18.0858 12.4142 17.5858C12.9287 16.5859 13.778 15.7852 14.9247 15.3063C15.2767 15.1582 15.6062 14.9431 16 14.6672V14.6672C17.2283 13.5151 18 11.8557 18 10Z" stroke="currentColor" stroke-width="2"/><path d="M12 10V12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M12 18V20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M4 12H2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M22 12H20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M6.34277 6.34375L4.92856 4.92953" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M19.0714 19.0718L17.6572 17.6576" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                    <h3 class="module-title">行星气象</h3>
                </div>
                <div class="module-content">
                    <div id="weather-result" class="result-area default-text">请求行星气象数据...</div>
                </div>
            </section>

            <!-- 新闻模块 -->
            <section class="module-card" id="news-module">
                <div class="module-header">
                    <svg class="module-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14 2H6C4.89543 2 4 2.89543 4 4V20C4 21.1046 4.89543 22 6 22H18C19.1046 22 20 21.1046 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 13H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 17H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M10 9H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    <h3 class="module-title">星际广播</h3>
                </div>
                <div class="module-content">
                    <div id="news-result" class="result-area default-text">接收星际广播信号...</div>
                </div>
            </section>

            <!-- 文件模块 -->
            <section class="module-card" id="file-module">
                <div class="module-header">
                    <svg class="module-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13 2H6C4.89543 2 4 2.89543 4 4V20C4 21.1046 4.89543 22 6 22H18C19.1046 22 20 21.1046 20 20V9L13 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M13 2V9H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    <h3 class="module-title">数据核心</h3>
                </div>
                <div class="module-content">
                    <div id="file-result" class="result-area default-text">访问数据核心...</div>
                </div>
            </section>

            <!-- 网页浏览模块 -->
            <section class="module-card" id="browser-module">
                <div class="module-header">
                    <svg class="module-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2"/><path d="M3.6 9H20.4" stroke="currentColor" stroke-width="2"/><path d="M3.6 15H20.4" stroke="currentColor" stroke-width="2"/><path d="M12 3C14.4092 3 16.5313 4.43623 17.6568 6.5" stroke="currentColor" stroke-width="2"/><path d="M12 21C9.59081 21 7.46872 19.5638 6.34315 17.5" stroke="currentColor" stroke-width="2"/></svg>
                    <h3 class="module-title">跃迁信标解析</h3>
                </div>
                <div class="module-content">
                    <div class="input-group">
                        <input type="url" id="url-input" class="module-input" placeholder="输入信标地址 (URL)..." onkeypress="handleUrlKeyPress(event)"/>
                        <button class="action-btn" onclick="extractContent()">解析</button>
                    </div>
                    <div id="browser-result" class="result-area default-text">等待信标地址...</div>
                </div>
            </section>

            <!-- 研究模块 -->
            <section class="module-card" id="research-module">
                <div class="module-header">
                    <svg class="module-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.5 15.5L19 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M5 11C5 14.3137 7.68629 17 11 17C12.6597 17 14.1652 16.3281 15.2483 15.2452C16.3314 14.1623 17 12.6568 17 11C17 7.68629 14.3137 5 11 5C7.68629 5 5 7.68629 5 11Z" stroke="currentColor" stroke-width="2"/><path d="M11 5V2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M11 20V17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M20 11H17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M5 11H2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                    <h3 class="module-title">深空探测</h3>
                </div>
                <div class="module-content">
                    <div class="input-group">
                        <input type="text" id="research-input" class="module-input" placeholder="输入探测主题..." onkeypress="handleResearchKeyPress(event)"/>
                        <button class="action-btn" onclick="doResearch()">探测</button>
                    </div>
                    <div id="research-result" class="result-area default-text">等待探测指令...</div>
                </div>
            </section>

            <!-- 计算器模块 -->
            <section class="module-card" id="calc-module">
                <div class="module-header">
                    <svg class="module-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 4H6C4.89543 4 4 4.89543 4 6V18C4 19.1046 4.89543 20 6 20H18C19.1046 20 20 19.1046 20 18V6C20 4.89543 19.1046 4 18 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 8H8.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 8H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 8H16.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 12H8.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 12H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 12H16.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 16H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    <h3 class="module-title">运算核心</h3>
                </div>
                <div class="module-content">
                    <div class="input-group">
                        <input type="text" id="calc-input" class="module-input" placeholder="输入运算公式..." onkeypress="handleCalcKeyPress(event)"/>
                        <button class="action-btn" onclick="doCalculate()">运算</button>
                    </div>
                    <div id="calc-result" class="result-area default-text">等待运算指令...</div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // --- 交互效果 ---
        document.addEventListener('DOMContentLoaded', function () {
            // 标题打字机效果
            const titleText = "FLYING ADVENTURE";
            const titleElement = document.getElementById('main-title');
            let i = 0;
            function typeWriter() {
                if (i < titleText.length) {
                    titleElement.innerHTML += titleText.charAt(i);
                    i++;
                    setTimeout(typeWriter, 100);
                } else {
                    titleElement.style.borderRight = 'none';
                }
            }
            typeWriter();

            // 实时时钟
            const clockElement = document.getElementById('live-clock');
            function updateClock() {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                clockElement.textContent = `${hours}:${minutes}:${seconds}`;
            }
            setInterval(updateClock, 1000);
            updateClock();

            // 自动加载所有功能
            setTimeout(() => {
                autoLoadAllFunctions();
            }, 1500); // 延迟加载以等待开场动画
        });

        // --- AI Agent API (保持不变) ---
        window.aiAgentAPI = {
            baseURL: 'http://localhost:8080',
            async callAPI(endpoint, input) {
                try {
                    const response = await fetch(`${this.baseURL}/api/preset/${endpoint}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ input: input, thread_id: 'dashboard_' + Date.now() })
                    });
                    const data = await response.json();
                    if (!data.success) return '查询失败: ' + (data.error || '未知错误');
                    return data.response;
                } catch (error) {
                    return '网络错误: ' + error.message;
                }
            },
            weather: (city = '北京') => window.aiAgentAPI.callAPI('weather', city),
            news: (topic = '今日头条') => window.aiAgentAPI.callAPI('news', topic),
            extract: (url) => window.aiAgentAPI.callAPI('extract', url),
            research: (topic) => window.aiAgentAPI.callAPI('research', topic),
            calculate: (expr) => window.aiAgentAPI.callAPI('calculate', expr),
            datetime: (query = 'current') => window.aiAgentAPI.callAPI('datetime', query),
            file: (operation) => window.aiAgentAPI.callAPI('file', operation)
        };

        // --- UI 更新函数 ---
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="loading-indicator"><div class="scanner"></div><span>PROCESSING...</span></div>`;
            element.classList.remove('default-text');
        }

        function showResult(elementId, result) {
            const element = document.getElementById(elementId);
            element.classList.remove('default-text');
            try {
                const jsonStart = result.indexOf('{');
                const jsonEnd = result.lastIndexOf('}');
                const jsonData = JSON.parse(result.substring(jsonStart, jsonEnd + 1));
                const formattedHTML = formatJSONData(jsonData);
                element.innerHTML = `<div class="result-container">${formattedHTML}</div>`;
            } catch (e) {
                element.innerHTML = `<div class="result-container"><div class="content-text">${result}</div></div>`;
            }
        }

        function formatJSONData(data) {
            if (!data || !data.type) return `<div class="content-text">${JSON.stringify(data, null, 2)}</div>`;
            switch (data.type) {
                case 'weather': return formatWeatherData(data);
                case 'news': return formatNewsData(data);
                case 'extract': return formatExtractData(data);
                case 'research': return formatResearchData(data);
                case 'calculate': return formatCalculateData(data);
                case 'datetime': return formatDateTimeData(data);
                case 'file': return formatFileData(data);
                default: return `<div class="content-text">${JSON.stringify(data, null, 2)}</div>`;
            }
        }

        // --- 数据格式化函数 (美化版) ---
        function formatWeatherData(data) {
            return `
                <div class="result-header">
                    <h3>${data.city || '未知行星'} 气象报告</h3>
                    <div class="temperature">${data.temperature?.current || 'N/A'}</div>
                </div>
                <div class="info-row"><span class="label">状况:</span><span class="value">${data.condition || '未知'}</span></div>
                <div class="info-row"><span class="label">范围:</span><span class="value">${data.temperature?.low || 'N/A'} ~ ${data.temperature?.high || 'N/A'}</span></div>
                <div class="info-row"><span class="label">湿度:</span><span class="value">${data.humidity || 'N/A'}</span></div>
                <div class="info-row"><span class="label">风力:</span><span class="value">${data.wind || 'N/A'}</span></div>
                ${data.suggestions?.length > 0 ? `
                <div class="sub-section">
                    <h4>行动建议:</h4>
                    <ul>${data.suggestions.map(s => `<li>${s}</li>`).join('')}</ul>
                </div>` : ''}
            `;
        }

        function formatNewsData(data) {
            return `
                <div class="result-header"><h3>${data.topic} 广播摘要</h3></div>
                ${data.articles.map(article => `
                    <div class="article">
                        <h4>${article.title}</h4>
                        <p class="article-meta">来源: ${article.source} | 时间: ${article.time}</p>
                        <p>${article.summary}</p>
                    </div>
                `).join('')}
                <div class="sub-section">
                    <h4>关键情报:</h4>
                    <ul>${data.keyPoints.map(p => `<li>${p}</li>`).join('')}</ul>
                </div>
            `;
        }
        
        function formatExtractData(data) {
            return `
                <div class="result-header"><h3>${data.title}</h3></div>
                <div class="sub-section">
                    <h4>核心内容:</h4>
                    <p>${data.mainContent}</p>
                </div>
                <div class="sub-section">
                    <h4>技术堆栈:</h4>
                    <p>${data.technologies.join(', ')}</p>
                </div>
            `;
        }

        function formatResearchData(data) {
            return `
                <div class="result-header"><h3>${data.topic} 探测报告</h3></div>
                <div class="sub-section">
                    <h4>核心发现:</h4>
                    <ul>${data.keyFindings.map(f => `<li>${f}</li>`).join('')}</ul>
                </div>
                <div class="sub-section">
                    <h4>详细分析:</h4>
                    <p>${data.detailedAnalysis}</p>
                </div>
            `;
        }

        function formatCalculateData(data) {
            return `
                <div class="result-header">
                    <h3>运算结果</h3>
                    <div class="result-value">${data.result}</div>
                </div>
                <div class="info-row"><span class="label">表达式:</span><span class="value">${data.expression}</span></div>
                <div class="sub-section">
                    <h4>运算步骤:</h4>
                    <ol>${data.steps.map(s => `<li>${s}</li>`).join('')}</ol>
                </div>
            `;
        }

        function formatDateTimeData(data) {
            // 时间数据现在由实时时钟处理，但API调用结果可以显示在这里
            document.getElementById('live-clock').style.display = 'none';
            document.getElementById('time-result').style.display = 'block';
            return `
                <div class="result-header"><h3>时间同步信息</h3></div>
                <div class="info-row"><span class="label">当前时间:</span><span class="value">${data.currentTime}</span></div>
                <div class="info-row"><span class="label">日期:</span><span class="value">${data.date}</span></div>
                <div class="info-row"><span class="label">星期:</span><span class="value">${data.weekday}</span></div>
                <div class="info-row"><span class="label">时区:</span><span class="value">${data.timezone}</span></div>
                <div class="info-row"><span class="label">时间戳:</span><span class="value">${data.formats.timestamp}</span></div>
            `;
        }

        function formatFileData(data) {
            return `
                <div class="result-header"><h3>数据核心访问</h3></div>
                <div class="info-row"><span class="label">路径:</span><span class="value">${data.path}</span></div>
                <div class="info-row"><span class="label">操作:</span><span class="value">${data.operation}</span></div>
                <div class="info-row"><span class="label">结果:</span><span class="value">${data.result}</span></div>
                <div class="sub-section">
                    <h4>数据内容:</h4>
                    <pre class="content-text">${data.content}</pre>
                </div>
            `;
        }

        // --- 功能触发函数 ---
        async function getWeatherInfo() {
            showLoading('weather-result');
            const result = await window.aiAgentAPI.weather('北京');
            showResult('weather-result', result);
        }

        async function getNewsInfo() {
            showLoading('news-result');
            const result = await window.aiAgentAPI.news('本日新闻');
            showResult('news-result', result);
        }

        async function extractContent() {
            const url = document.getElementById('url-input').value.trim();
            if (!url) { showResult('browser-result', '请输入有效的信标地址'); return; }
            showLoading('browser-result');
            const result = await window.aiAgentAPI.extract(url);
            showResult('browser-result', result);
        }

        async function doResearch() {
            const topic = document.getElementById('research-input').value.trim();
            if (!topic) { showResult('research-result', '请输入探测主题'); return; }
            showLoading('research-result');
            const result = await window.aiAgentAPI.research(topic);
            showResult('research-result', result);
        }

        async function doCalculate() {
            const expression = document.getElementById('calc-input').value.trim();
            if (!expression) { showResult('calc-result', '请输入运算公式'); return; }
            showLoading('calc-result');
            const result = await window.aiAgentAPI.calculate(expression);
            showResult('calc-result', result);
        }

        async function getCurrentTime() {
            showLoading('time-result');
            const result = await window.aiAgentAPI.datetime('current');
            showResult('time-result', result);
        }

        async function showFileContent() {
            showLoading('file-result');
            const targetPath = '/Users/yaoerzhuang/dev/work/agent/langGrap-info-create/展示的文件内容.md';
            const result = await window.aiAgentAPI.file(`read:${targetPath}`);
            showResult('file-result', result);
        }

        // --- 键盘事件处理 ---
        function handleUrlKeyPress(event) { if (event.key === 'Enter') extractContent(); }
        function handleResearchKeyPress(event) { if (event.key === 'Enter') doResearch(); }
        function handleCalcKeyPress(event) { if (event.key === 'Enter') doCalculate(); }

        // --- 自动加载所有功能 ---
        async function autoLoadAllFunctions() {
            document.getElementById('url-input').value = 'https://news.cctv.com/';
            document.getElementById('research-input').value = 'agent前沿';
            document.getElementById('calc-input').value = '1+9*20-2';

            getWeatherInfo();
            getNewsInfo();
            extractContent();
            doResearch();
            doCalculate();
            showFileContent();
            // getCurrentTime(); // 时间模块默认显示实时时钟，API调用可手动触发或按需
        }
    </script>

<script>
// AI网页设计师 - 高级功能集成
// 检查是否已经存在aiAgentAPI，如果不存在才创建
if (!window.aiAgentAPI) {
    window.aiAgentAPI = {
        baseURL: 'http://localhost:8080',
        
        // 通用API调用函数
        async callAPI(endpoint, input) {
            try {
                const response = await fetch(`${this.baseURL}/api/preset/${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        input: input, 
                        thread_id: 'ai_webpage_' + Date.now() 
                    })
                });
                const data = await response.json();
                return data.success ? data.response : '查询失败: ' + (data.error || '未知错误');
            } catch (error) {
                return '网络错误: ' + error.message;
            }
        },
        
        // 各种功能的便捷方法
        weather: (city = '北京') => window.aiAgentAPI.callAPI('weather', city),
        news: (topic = '今日头条') => window.aiAgentAPI.callAPI('news', topic),
        extract: (url) => window.aiAgentAPI.callAPI('extract', url),
        research: (topic) => window.aiAgentAPI.callAPI('research', topic),
        calculate: (expr) => window.aiAgentAPI.callAPI('calculate', expr),
        datetime: (query = 'current') => window.aiAgentAPI.callAPI('datetime', query),
        file: (operation) => window.aiAgentAPI.callAPI('file', operation),
        system: (type = 'all') => window.aiAgentAPI.callAPI('system', type)
    };
    console.log('🔧 创建了简化版 aiAgentAPI');
} else {
    console.log('✅ 检测到已存在完整版 aiAgentAPI，跳过重复创建');
}

// 智能结果显示函数 - 尝试使用现有的JSON处理逻辑
function showSmartResult(element, result) {
    // 检查是否存在完整的JSON处理函数
    if (typeof window.parseAndShowResult === 'function') {
        // 为element创建临时ID（如果没有）
        if (!element.id) {
            element.id = 'temp_result_' + Date.now();
        }
        console.log('🎯 使用完整版JSON处理逻辑显示结果');
        window.parseAndShowResult(element.id, result);
    } else if (typeof window.showResult === 'function') {
        // 使用showResult函数
        if (!element.id) {
            element.id = 'temp_result_' + Date.now();
        }
        console.log('📋 使用showResult函数显示结果');
        window.showResult(element.id, result);
    } else {
        // 回退到简单显示
        console.log('📝 使用简单文本显示结果');
        element.innerHTML = `<pre style="white-space: pre-wrap; font-size: 0.9em; line-height: 1.4; max-height: 300px; overflow-y: auto;">${result}</pre>`;
    }
}

// 自动为所有功能区域添加点击事件
document.addEventListener('DOMContentLoaded', function() {
    // 智能识别功能区域
    const functionalElements = document.querySelectorAll(
        '[class*="weather"], [class*="news"], [class*="browser"], [class*="research"], ' +
        '[class*="calculator"], [class*="time"], [class*="file"], [class*="system"], ' +
        '[data-function], .dashboard-card, .card, .panel, .widget'
    );
    
    functionalElements.forEach(element => {
        // 避免重复绑定
        if (element.hasAttribute('data-ai-bound')) return;
        element.setAttribute('data-ai-bound', 'true');
        
        element.style.cursor = 'pointer';
        
        // 为输入框阻止事件冒泡，这样点击输入框不会触发AI请求
        const inputs = element.querySelectorAll('input, textarea, select');
        inputs.forEach(input => {
            input.style.cursor = 'text';
            input.addEventListener('click', function(event) {
                event.stopPropagation(); // 阻止事件冒泡
                console.log('📝 输入框可正常编辑');
            });
        });
        
        element.addEventListener('click', async function() {
            // 智能识别功能类型
            const text = this.textContent || this.className || '';
            const classList = Array.from(this.classList).join(' ');
            
            let result = '';
            let loadingElement = this.querySelector('.card-content, .content, .body, .result-container') || this;
            
            // 显示加载状态
            const originalContent = loadingElement.innerHTML;
            loadingElement.innerHTML = '<div class="loading">正在处理中...</div>';
            
            try {
                if (text.includes('天气') || classList.includes('weather')) {
                    const cityInput = this.querySelector('input[type="text"]');
                    const city = cityInput ? cityInput.value.trim() || '北京' : '北京';
                    result = await window.aiAgentAPI.weather(city);
                } else if (text.includes('新闻') || classList.includes('news')) {
                    const topicInput = this.querySelector('input[type="text"]');
                    const topic = topicInput ? topicInput.value.trim() || '科技新闻' : '科技新闻';
                    result = await window.aiAgentAPI.news(topic);
                } else if (text.includes('网页') || text.includes('浏览') || classList.includes('browser')) {
                    const urlInput = this.querySelector('input[type="text"], input[type="url"]');
                    if (urlInput && urlInput.value.trim()) {
                        result = await window.aiAgentAPI.extract(urlInput.value.trim());
                    } else {
                        result = '请在输入框中输入URL，然后点击卡片空白区域触发提取\n示例: https://www.example.com';
                    }
                } else if (text.includes('研究') || text.includes('分析') || classList.includes('research')) {
                    const researchInput = this.querySelector('input[type="text"], textarea');
                    const topic = researchInput ? researchInput.value.trim() || '人工智能发展趋势' : '人工智能发展趋势';
                    result = await window.aiAgentAPI.research(topic);
                } else if (text.includes('计算') || classList.includes('calculator')) {
                    const calcInput = this.querySelector('input[type="text"]');
                    const expr = calcInput ? calcInput.value.trim() || 'sqrt(16) + log(10)' : 'sqrt(16) + log(10)';
                    result = await window.aiAgentAPI.calculate(expr);
                } else if (text.includes('时间') || classList.includes('time')) {
                    result = await window.aiAgentAPI.datetime('current');
                } else if (text.includes('文件') || classList.includes('file')) {
                    const fileInput = this.querySelector('input[type="text"]');
                    const operation = fileInput ? fileInput.value.trim() || 'list:.' : 'list:.';
                    result = await window.aiAgentAPI.file(operation);
                } else if (text.includes('系统') || classList.includes('system')) {
                    result = await window.aiAgentAPI.system('memory');
                } else {
                    result = '✨ AI功能区域\n输入框可正常编辑，点击卡片其他区域触发AI请求';
                }
                
                // 使用智能结果显示
                showSmartResult(loadingElement, result);
                
            } catch (error) {
                loadingElement.innerHTML = `<div style="color: #e74c3c;">❌ 错误: ${error.message}</div>`;
            }
        });
    });
    
    console.log('🎨 AI网页设计师功能集成完成，找到', functionalElements.length, '个功能区域');
    console.log('💡 提示：输入框可正常编辑，点击卡片其他区域触发AI请求');
});
</script>
</body>
</html>