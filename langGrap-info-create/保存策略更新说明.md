# 保存策略更新说明

## 修改概述
根据用户要求，已将历史记录保存策略调整为**仅保存AI设计类型的提示词**。

## 具体修改

### 修改前的保存策略
- ✅ 所有类型的查询都会保存提示词历史
- ✅ AI设计类型额外保存网页生成记录

### 修改后的保存策略
- ❌ 其他类型查询不保存历史记录
- ✅ **仅AI设计类型**保存提示词历史和网页生成记录

## 涉及的查询类型

### 不再保存的类型
- `weather` - 天气查询
- `news` - 新闻搜索
- `extract` - 网页内容提取
- `research` - 研究调查
- `calculate` - 计算任务
- `datetime` - 时间查询
- `file` - 文件操作

### 继续保存的类型
- `ai_design` - AI网页设计（保存提示词历史 + 网页生成记录）

## 技术实现

### 修改的代码位置
- `langGrap-info-create/web_agent.py` 第705-754行
- `preset_query` 函数中的历史记录保存逻辑

### 关键修改
1. **条件判断调整**：
   ```python
   # 修改前
   if user and result.get('success'):
   
   # 修改后
   if user and result.get('success') and preset_type == 'ai_design':
   ```

2. **类型安全检查**：
   - 为所有 `access_token` 使用添加了空值检查
   - 确保Supabase RLS认证的正确性

## 优势

1. **减少存储压力**：避免存储大量非核心的查询记录
2. **专注核心功能**：突出AI设计创作的重要性
3. **性能优化**：减少数据库写入操作
4. **用户体验**：历史记录更加聚焦和有价值

## 日期
2024年12月29日 